<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Space Fighter</title>
	<style>
	canvas{
		border:1px solid black;
	}
	</style>
	<script src="js/jquery-2.2.3.min.js"></script>
</head>
<body>
<canvas id="space-fighter" width="400" height="400"></canvas>
<script src="/socket.io/socket.io.js"></script>
<script>
var io = io.connect(),
	canvas = document.getElementById('space-fighter'),
	ctx = canvas.getContext('2d');

var players = [];

io.on('players', function(pl) {
	console.log(pl.length);
	players = pl;
});
io.on('moved', function(player) {
	for(var i = 0; i < players.length; i++)
		if(players[i].id === player.id)players[i] = player;
});

$(document).on('keydown', function (e) {
	var k = e.keyCode;

	if(k === 38)
		io.emit('move', 'up');
	if(k === 40)
		io.emit('move', 'down');
	if(k === 37)
		io.emit('move', 'left');
	if(k === 39)
		io.emit('move', 'right');
}).on('keyup', function() {
	io.emit('stopmove');
});

function draw() {
	ctx.clearRect(0,0,canvas.width,canvas.height);
	for(var i = 0; i < players.length; i++)
		ctx.fillRect(players[i].coords.x, players[i].coords.y, 10, 10);


	ctx.beginPath();
	ctx.moveTo(200,0);
	ctx.lineTo(200,400);
	ctx.moveTo(0, 200);
	ctx.lineTo(400, 200);
	ctx.stroke();
	requestAnimationFrame(draw);
}
draw();



</script>

</body>
</html>